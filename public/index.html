<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANIHARVEST // OMNI_STATION_V15_FINAL</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-base: #020202;
            --bg-sub: #08080a;
            --primary: #c084fc;
            --primary-glow: rgba(192, 132, 252, 0.4);
            --legal: #34d399;
            --burst: #fbbf24;
            --ghost: #f43f5e;
            --web: #60a5fa;
            --text: #ffffff;
            --text-muted: #71717a;
            --border: rgba(255, 255, 255, 0.08);
            --radius-xl: 32px;
            --radius-lg: 20px;
            --radius-md: 12px;
        }

        [data-theme="deepmind"] { --primary: #00ff41; --primary-glow: rgba(0, 255, 65, 0.4); }
        [data-theme="cyber"] { --primary: #ff00ff; --primary-glow: rgba(255, 0, 255, 0.5); --bg-base: #0a000a; }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-font-smoothing: antialiased; }
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
        
        body { background: var(--bg-base); color: var(--text); font-family: 'Outfit', sans-serif; display: flex; height: 100vh; overflow: hidden; transition: 0.5s; }

        #matrix-bg { position: fixed; inset: 0; pointer-events: none; z-index: 0; opacity: 0; transition: 1s; }
        canvas { display: block; filter: blur(1px); }

        .barrel-roll { animation: roll 1s cubic-bezier(0.19, 1, 0.22, 1); }
        @keyframes roll { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* --- SUPREME SIDEBAR --- */
        aside {
            width: 480px; background: #000; border-right: 1px solid var(--border);
            display: flex; flex-direction: column; padding: 45px; gap: 35px;
            z-index: 100; position: relative; box-shadow: 20px 0 100px rgba(0,0,0,0.9);
        }

        .header-brand { display: flex; align-items: center; gap: 20px; cursor: help; user-select: none; }
        .logo-ring { width: 60px; height: 60px; border-radius: 16px; border: 2px solid var(--primary); display: flex; align-items: center; justify-content: center; box-shadow: 0 0 25px var(--primary-glow); transition: 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .header-brand:hover .logo-ring { transform: rotate(180deg) scale(1.1); }
        .logo-ring svg { width: 34px; height: 34px; fill: var(--primary); }
        .brand-title { font-size: 34px; font-weight: 950; letter-spacing: -3px; }
        .brand-title span { background: linear-gradient(135deg, var(--primary), #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        .scroller { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 40px; padding-right: 15px; }
        .scroller::-webkit-scrollbar { width: 2px; }

        .label-ind { font-size: 11px; font-weight: 900; color: var(--text-muted); text-transform: uppercase; letter-spacing: 5px; display: flex; align-items: center; gap: 15px; margin-bottom: 5px; }
        .label-ind::after { content: ''; flex: 1; height: 1px; background: var(--border); }

        /* Protocol Grid */
        .grid-protocols { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
        .card-protocol {
            background: #0d0d0f; border: 1px solid var(--border); padding: 24px 20px; border-radius: var(--radius-lg);
            cursor: pointer; transition: 0.4s cubic-bezier(0.19, 1, 0.22, 1); text-align: left;
        }
        .card-protocol:hover { border-color: rgba(255,255,255,0.2); transform: translateY(-3px); }
        .card-protocol.active { border-color: var(--primary); background: rgba(var(--primary-rgb, 192, 132, 252), 0.1); box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .p-name { font-size: 14px; font-weight: 950; text-transform: uppercase; display: flex; align-items: center; gap: 10px; margin-bottom: 6px; }
        .p-desc { font-size: 10px; color: var(--text-muted); line-height: 1.4; }

        .active[data-mode="LEGAL"] .p-name { color: var(--legal); }
        .active[data-mode="BURST"] .p-name { color: var(--burst); }
        .active[data-mode="GHOST"] .p-name { color: var(--ghost); }
        .active[data-mode="WEB"] .p-name { color: var(--web); }

        /* Tactical Inputs */
        .hud-grid { display: flex; flex-direction: column; gap: 25px; }
        .hud-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .hud-group { display: flex; flex-direction: column; gap: 12px; }
        .hud-label { font-size: 10px; font-weight: 950; color: var(--text-muted); text-transform: uppercase; padding-left: 15px; }
        .hud-field {
            width: 100%; background: #000; border: 1px solid var(--border); color: #fff; padding: 20px 25px; 
            border-radius: var(--radius-md); font-family: 'Outfit'; font-size: 17px; transition: 0.3s; outline: none;
        }
        .hud-field:focus { border-color: var(--primary); box-shadow: 0 0 25px var(--primary-glow); }

        /* Sentinel Module */
        .sentinel-module { background: rgba(255,255,255,0.02); border: 1px solid var(--border); padding: 20px; border-radius: 18px; display: flex; flex-direction: column; gap: 15px; }
        .toggle-box { display: flex; justify-content: space-between; align-items: center; }
        .switch { position: relative; display: inline-block; width: 48px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; inset: 0; background-color: #1a1a1c; transition: .4s; border-radius: 34px; border: 1px solid var(--border); }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary); border-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(24px); }

        /* Master Controls */
        .control-stack { display: flex; flex-direction: column; gap: 15px; }
        .btn-prime {
            background: linear-gradient(135deg, var(--primary), #6d28d9); color: #000; border: none; padding: 25px;
            border-radius: 22px; font-weight: 950; font-size: 18px; cursor: pointer; transition: 0.4s;
            display: flex; align-items: center; justify-content: center; gap: 15px; box-shadow: 0 20px 60px var(--primary-glow);
            text-transform: uppercase;
        }
        .btn-prime:hover { transform: translateY(-5px); filter: brightness(1.1); box-shadow: 0 30px 80px var(--primary-glow); }

        .btn-sub-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .btn-sub {
            background: rgba(255, 255, 255, 0.04); border: 1px solid var(--border); color: #fff; padding: 18px; 
            border-radius: 16px; font-weight: 900; font-size: 11px; cursor: pointer; transition: 0.3s; text-transform: uppercase;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-sub:hover { background: rgba(255, 255, 255, 0.08); }
        .btn-sub.active { border-color: var(--legal); color: var(--legal); background: rgba(52, 211, 153, 0.05); }

        /* Telemetry Cards */
        .tele-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .tele-card { background: #0c0c0e; border: 1px solid var(--border); padding: 25px 20px; border-radius: var(--radius-lg); position: relative; overflow: hidden; }
        .tele-card::after { content: ''; position: absolute; bottom:0; left:0; width:100%; height:4px; background: var(--border); }
        #v-tele::after { background: var(--legal); }
        #s-tele::after { background: var(--primary); }
        .tele-lbl { font-size: 10px; font-weight: 900; color: var(--text-muted); text-transform: uppercase; margin-bottom: 8px; display: flex; align-items: center; gap: 10px; }
        .tele-val { font-size: 28px; font-weight: 700; font-family: 'JetBrains Mono'; letter-spacing: -1.5px; }

        /* --- HARVEST STATION --- */
        main { flex: 1; display: flex; flex-direction: column; padding: 60px; gap: 45px; overflow: hidden; position: relative; z-index: 1; }

        .header-top { display: flex; justify-content: space-between; align-items: flex-end; }
        .title-group h1 { font-size: 60px; font-weight: 950; letter-spacing: -4px; line-height: 0.85; cursor: pointer; }
        .title-group p { font-size: 18px; color: var(--text-muted); font-weight: 500; margin-top: 15px; }

        .status-pill {
            background: rgba(255,255,255,0.03); border: 1px solid var(--border); padding: 15px 35px; border-radius: 100px;
            display: flex; align-items: center; gap: 20px; cursor: pointer; transition: 0.3s;
            font-family: 'JetBrains Mono'; font-size: 13px; font-weight: 900;
        }
        .dot { width: 12px; height: 12px; border-radius: 50%; background: #222; position: relative; }
        .dot.active { background: var(--legal); box-shadow: 0 0 20px var(--legal); }
        .dot.active::after { content: ''; position: absolute; inset: -4px; border-radius: 50%; background: var(--legal); opacity: 0.3; animation: heartbeat 1.8s infinite; }
        @keyframes heartbeat { from { transform: scale(1); opacity: 0.6; } to { transform: scale(3.5); opacity: 0; } }

        /* UNIFORM GRID */
        .discovery-grid {
            flex: 1; display: grid; grid-template-columns: repeat(auto-fill, minmax(230px, 1fr)); gap: 40px;
            overflow-y: auto; padding: 25px 15px; align-content: start;
        }
        .discovery-grid::-webkit-scrollbar { width: 0px; }

        .anime-card {
            background: #08080a; border: 1px solid var(--border); border-radius: var(--radius-xl); aspect-ratio: 2/3;
            overflow: hidden; transition: 0.7s cubic-bezier(0.19, 1, 0.22, 1); position: relative; cursor: pointer;
            animation: cardSlideIn 0.8s backwards;
        }
        @keyframes cardSlideIn { from { opacity: 0; transform: translateY(60px); } }
        .anime-card:hover { border-color: var(--primary); transform: translateY(-15px) scale(1.04); box-shadow: 0 50px 120px rgba(0,0,0,0.95); z-index: 50; }
        .anime-poster { width: 100%; height: 100%; object-fit: cover; transition: 0.7s; }
        .anime-card:hover .anime-poster { filter: brightness(0.2) blur(10px); }
        
        .card-overlay {
            position: absolute; inset: 0; padding: 35px; display: flex; flex-direction: column; justify-content: flex-end;
            background: linear-gradient(0deg, #000 40%, transparent 100%);
            opacity: 0; transform: translateY(30px); transition: 0.5s cubic-bezier(0.19, 1, 0.22, 1);
        }
        .anime-card:hover .card-overlay { opacity: 1; transform: translateY(0); }
        .anime-name { font-size: 20px; font-weight: 950; line-height: 1.1; margin-bottom: 18px; text-transform: uppercase; }
        .anime-meta { display: flex; justify-content: space-between; align-items: center; border-top: 1px solid rgba(255,255,255,0.15); padding-top: 18px; }
        .meta-tag { font-size: 11px; font-weight: 900; text-transform: uppercase; color: var(--primary); letter-spacing: 2px; }

        /* LOG MANAGER */
        .logs-orchestrator { 
            height: 380px; display: grid; grid-template-columns: 1.5fr 1fr; gap: 25px; 
            transition: 0.7s cubic-bezier(0.19, 1, 0.22, 1);
            resize: vertical; overflow: hidden; min-height: 80px;
        }
        .logs-orchestrator.hidden { height: 0 !important; opacity: 0; pointer-events: none; margin-bottom: -50px; }

        .log-unit { background: #000; border: 1px solid var(--border); border-radius: var(--radius-lg); display: flex; flex-direction: column; overflow: hidden; }
        .log-head { background: #08080a; padding: 18px 30px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .log-tab { font-size: 11px; font-weight: 950; color: var(--text-muted); text-transform: uppercase; letter-spacing: 4px; }
        .log-body { flex: 1; padding: 25px; font-family: 'JetBrains Mono'; font-size: 12px; overflow-y: auto; line-height: 2; color: #cbd5e1; }

        /* OVERLAYS */
        .full-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.98); backdrop-filter: blur(80px);
            z-index: 2000; display: none; align-items: center; justify-content: center;
        }
        .overlay-panel { max-width: 650px; padding: 80px; border-radius: 60px; background: #000; border: 3px solid var(--ghost); text-align: center; }
        .op-title { font-size: 48px; font-weight: 950; color: var(--ghost); margin: 30px 0; letter-spacing: -3px; }
        .op-timer { font-size: 120px; font-weight: 900; font-family: 'JetBrains Mono'; color: #fff; line-height: 0.8; }

        /* TOASTS */
        #toast-nexus { position: fixed; top: 40px; right: 40px; z-index: 3000; display: flex; flex-direction: column; gap: 15px; pointer-events: none; }
        .toast {
            min-width: 380px; background: #0c000c; border: 1px solid var(--border); border-radius: 20px;
            padding: 22px 30px; color: #fff; transform: translateX(120%); transition: 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            font-weight: 800; font-size: 15px; box-shadow: 0 30px 60px rgba(0,0,0,0.6);
        }
        .toast.visible { transform: translateX(0); }

        .rainbow-text { animation: rainbow 4s linear infinite; }
        @keyframes rainbow { 0% { color: #ff0000; } 20% { color: #ffff00; } 40% { color: #00ff00; } 60% { color: #00ffff; } 80% { color: #0000ff; } 100% { color: #ff00ff; } }
    </style>
</head>
<body id="omni-body">
    <div id="matrix-bg"></div>
    <div id="toast-nexus"></div>

    <div id="throttle-overlay" class="full-overlay">
        <div class="overlay-panel">
            <svg width="120" height="120" viewBox="0 0 24 24" fill="var(--ghost)"><path d="M12 2L1 21h22L12 2zm0 3.45L19.53 19H4.47L12 5.45zM11 16h2v2h-2v-2zm0-7h2v5h-2V9z"/></svg>
            <div class="op-title">THROTTLE_PUNISHMENT</div>
            <p style="color:var(--text-muted); font-size: 20px; margin-bottom: 40px;">Rate limit exceeded. Initiating protocol cooling...</p>
            <div id="throttle-clock" class="op-timer">00</div>
        </div>
    </div>

    <div id="storage-overlay" class="full-overlay">
        <div class="overlay-panel" style="border-color: var(--burst)">
            <svg width="120" height="120" viewBox="0 0 24 24" fill="var(--burst)"><path d="M21 2H3c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM12 4c2.21 0 4 1.79 4 4s-1.79 4-4 4-4-1.79-4-4 1.79-4 4-4zm-8 16c0-2.67 5.33-4 8-4s8 1.33 8 4v2H4v-2z"/></svg>
            <div class="op-title" style="color:var(--burst)">STORAGE_CRITICAL</div>
            <p style="color:var(--text-muted); font-size: 20px; margin-bottom: 40px;">Disk sentinel triggered. Emergency manual override required.</p>
            <button onclick="location.reload()" class="btn-prime" style="padding: 15px 40px; margin: 0 auto; box-shadow: none;">REBOOT_SYSTEM_INTERFACE</button>
        </div>
    </div>

    <aside>
        <div class="header-brand" id="logo-trigger">
            <div class="logo-ring">
                <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
            </div>
            <div class="brand-title" id="side-title">ANI<span>HARVEST</span></div>
        </div>

        <div class="scroller">
            <section>
                <div class="label-ind">Protocol Suite</div>
                <div class="grid-protocols">
                    <div class="card-protocol active" data-mode="LEGAL"><div class="p-name">Legal</div><div class="p-desc">Stealth 30 RPM</div></div>
                    <div class="card-protocol" data-mode="BURST"><div class="p-name">Burst</div><div class="p-desc">Power 90 RPM</div></div>
                    <div class="card-protocol" data-mode="GHOST"><div class="p-name">Ghost</div><div class="p-desc">Evasion Matrix</div></div>
                    <div class="card-protocol" data-mode="WEB"><div class="p-name">DOM</div><div class="p-desc">Chrome Fallen</div></div>
                </div>
            </section>

            <section class="hud-grid">
                <div class="label-ind">Target Vector</div>
                <div class="hud-row">
                    <div class="hud-group"><span class="hud-label">Init ID</span><input type="number" id="id-min" class="hud-field" value="1"></div>
                    <div class="hud-group"><span class="hud-label">Term ID</span><input type="number" id="id-max" class="hud-field" value="650000"></div>
                </div>
            </section>

            <section class="hud-grid">
                <div class="label-ind">Temporal Scope</div>
                <div class="hud-row">
                    <div class="hud-group"><span class="hud-label">Min Year</span><input type="number" id="y-min" class="hud-field" placeholder="Any"></div>
                    <div class="hud-group"><span class="hud-label">Max Year</span><input type="number" id="y-max" class="hud-field" placeholder="Any"></div>
                </div>
            </section>

            <section class="sentinel-module">
                <div class="label-ind" style="margin:0">Space Sentinel</div>
                <div class="toggle-box" id="safe-box">
                    <span class="hud-label" style="padding:0">Auto-Stop Protocol</span>
                    <label class="switch"><input type="checkbox" id="safe-tog"><span class="slider"></span></label>
                </div>
                <div id="safe-hud" style="display:none" class="hud-group">
                    <span class="hud-label">Disk Floor (GB)</span>
                    <input type="number" id="safe-floor" class="hud-field" value="5">
                </div>
            </section>

            <section class="control-stack">
                <div class="label-ind">Master Control</div>
                <button class="btn-prime" onclick="engageSequence()">ENGAGE HARVESTER</button>
                <div class="btn-sub-row">
                    <button id="p-btn" onclick="pauseSession()" class="btn-sub">Pause Stream</button>
                    <button id="res-btn" onclick="toggleResumeState()" class="btn-sub active">Resume ON</button>
                </div>
                <button onclick="doBarrelRoll()" class="btn-sub">Tactical Barrel Roll</button>
                <button onclick="terminateMatrix()" class="btn-sub" style="color:var(--ghost)">Factory Reset</button>
            </section>

            <section class="tele-grid">
                <div class="tele-card" id="v-tele"><div class="tele-lbl">Verified</div><div id="val-v" class="tele-val" onclick="rainbowStat(this)">0</div></div>
                <div class="tele-card" id="s-tele"><div class="tele-lbl">Saved</div><div id="val-s" class="tele-val">0</div></div>
                <div class="tele-card"><div class="tele-lbl">Scanning</div><div id="val-sc" class="tele-val">0</div></div>
                <div class="tele-card"><div class="tele-lbl">IP Limit</div><div id="val-l" class="tele-val">90</div></div>
            </section>
        </div>

        <div style="margin-top:auto">
            <div style="display:flex; justify-content:space-between; font-size:11px; font-weight:950; margin-bottom: 12px; color: var(--text-muted); letter-spacing: 3px;">
                <span>YIELD_CAPACITY</span>
                <span id="load-label">0.00%</span>
            </div>
            <div style="height:12px; background:rgba(255,255,255,0.05); border-radius:100px; overflow:hidden">
                <div id="load-bar" style="height:100%; background:linear-gradient(to right, var(--primary), #8b5cf6); width:0%; transition: 1s cubic-bezier(0.23, 1, 0.32, 1);"></div>
            </div>
        </div>
    </aside>

    <main>
        <header class="header-top">
            <div class="title-group">
                <h1 id="main-title">OMNI_COMMAND</h1>
                <p id="subt">Handshake ready. Deploy protocols.</p>
            </div>
            <div class="status-pill" id="log-pill" onclick="toggleLogs()">
                <div id="p-dot" class="dot"></div>
                <span id="p-text">SYSTEM_IDLE</span>
                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="3" style="margin-left:8px;"><path d="M18 15l-6-6-6 6"/></svg>
            </div>
        </header>

        <div class="discovery-grid" id="main-stream"></div>

        <section class="logs-orchestrator" id="log-mgr">
            <div class="log-unit">
                <div class="log-head">
                    <span class="log-tab">Network Defense Intel</span>
                    <button class="btn-sub" style="padding:5px; border:none; background:none;" onclick="toggleLogs()">[CLOSE_PANEL]</button>
                </div>
                <div id="intel-log" class="log-body"></div>
            </div>
            <div class="log-unit">
                <div class="log-head"><span class="log-tab">Commit Stream Archive</span></div>
                <div id="commit-log" class="log-body"></div>
            </div>
        </section>
    </main>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const body = document.getElementById('omni-body');
        let selectedMode = 'LEGAL';
        let isP = false;
        let resumeOn = true;
        let logsOn = true;
        let clicksL = 0;
        let clicksT = 0;

        // --- EASTER EGGS ---
        document.getElementById('logo-trigger').onclick = () => {
            clicksL++;
            if(clicksL % 7 === 0) { body.setAttribute('data-theme', 'deepmind'); toast("AGENTIC_OVERRIDE_ENABLED", "#00ff41"); }
            if(clicksL % 10 === 0) { document.querySelectorAll('.anime-card').forEach(c => c.style.borderRadius = clicksL % 20 === 0 ? '50%' : '32px'); toast("GEOMETRIC_RECALIBRATION_SYNCED", "#fff"); }
        };

        document.getElementById('side-title').onclick = () => {
            clicksT++;
            if(clicksT === 3) { document.getElementById('main-title').innerText = "DIVINE_RECOVERY_UNIT"; document.getElementById('main-title').classList.add('rainbow-text'); toast("GOD_MODE_ACTIVE", "#ff0ff"); }
        };

        function rainbowStat(el) { el.classList.toggle('rainbow-text'); toast("CHROMATIC_STREAM_LOCKED", "var(--primary)"); }
        function doBarrelRoll() { body.classList.add('barrel-roll'); setTimeout(() => body.classList.remove('barrel-roll'), 1000); toast("BARREL_ROLL_EXECUTED", "#fff"); }

        let keys = [];
        window.addEventListener('keydown', (e) => {
            keys.push(e.key.toLowerCase()); keys = keys.slice(-6);
            if(keys.join('') === 'matrix') { toggleMatrix(true); toast("SIMULATION_ACCESS_GRANTED", "#fff"); }
            if(keys.join('') === 'cyber') { body.setAttribute('data-theme', 'cyber'); toast("NEON_MATRIX_ACTIVE", "#ff00ff"); }
        });

        // --- PROTOCOLS ---
        document.querySelectorAll('.card-protocol').forEach(c => {
            c.onclick = () => {
                document.querySelectorAll('.card-protocol').forEach(x => x.classList.remove('active'));
                c.classList.add('active');
                selectedMode = c.dataset.mode;
                document.getElementById('subt').innerText = `${selectedMode}_STILL_ARMED // CLICK_ENGAGE`;
                toggleMatrix(selectedMode === 'GHOST');
            }
        });

        document.getElementById('safe-tog').onchange = (e) => {
            document.getElementById('safe-hud').style.display = e.target.checked ? 'flex' : 'none';
        }

        const stream = document.getElementById('main-stream');
        function logs(el, msg, color = '') {
            const d = document.createElement('div'); if(color) d.style.color = color;
            d.innerHTML = `<span style="opacity:0.3; margin-right:12px;">[${new Date().toLocaleTimeString('en-GB')}]</span> ${msg}`;
            el.prepend(d); if(el.children.length > 250) el.lastElementChild.remove();
        }

        function toggleLogs() {
            logsOn = !logsOn;
            document.getElementById('log-mgr').classList.toggle('hidden', !logsOn);
            document.getElementById('log-pill').querySelector('svg').style.transform = logsOn ? 'rotate(0deg)' : 'rotate(180deg)';
        }

        function toast(msg, color) {
            const nexus = document.getElementById('toast-nexus');
            const t = document.createElement('div');
            t.className = 'toast visible'; t.style.borderLeft = `8px solid ${color}`; t.innerText = msg;
            nexus.appendChild(t);
            setTimeout(() => { t.classList.remove('visible'); setTimeout(() => t.remove(), 600); }, 3500);
        }

        socket.on('terminal-log', m => logs(document.getElementById('intel-log'), m));
        socket.on('network-event', d => logs(document.getElementById('intel-log'), `>>> HIT: ${d.type} [${d.ids||'---'}]`, 'var(--web)'));

        socket.on('update', d => {
            document.getElementById('val-v').innerText = d.totalVerified.toLocaleString();
            document.getElementById('val-s').innerText = d.totalScraped.toLocaleString();
            document.getElementById('val-sc').innerText = d.totalScanning.toLocaleString();
            document.getElementById('val-l').innerText = d.remainingLimit;
            document.getElementById('load-label').innerText = d.percent + '%';
            document.getElementById('load-bar').style.width = d.percent + '%';
            
            const dot = document.getElementById('p-dot');
            const txt = document.getElementById('p-text');
            if(d.networkStatus !== 'IDLE') { dot.className = 'dot active'; txt.innerText = 'MISSION_ACTIVE'; txt.style.color = 'var(--legal)'; } 
            else { dot.className = 'dot'; txt.innerText = 'HUB_IDLE'; txt.style.color = 'inherit'; }

            document.getElementById('throttle-overlay').style.display = d.cooldown > 0 ? 'flex' : 'none';
            if(d.cooldown > 0) document.getElementById('throttle-clock').innerText = d.cooldown;
            document.getElementById('storage-overlay').style.display = d.storageWarning ? 'flex' : 'none';
        });

        socket.on('new-entry', a => {
            const card = document.createElement('div');
            card.className = 'anime-card';
            if(clicksL % 20 === 0 && clicksL > 0) card.style.borderRadius = '50%';
            card.innerHTML = `<img class="anime-poster" src="${a.cover}" onerror="this.src='https://placehold.co/400x600/111/444?text=ERROR'">
            <div class="card-overlay">
                <div class="anime-name">${a.title || 'ID: '+a.id}</div>
                <div class="anime-meta">
                    <span class="meta-tag">${a.type}</span>
                    <span style="font-size:10px; font-weight:900; opacity:0.6;">${a.isCache ? 'RESTORED' : 'MINED'} [REL: ${a.relations || 0}]</span>
                </div>
            </div>`;
            stream.prepend(card);
            if(stream.children.length > 50) stream.lastElementChild.remove();
            logs(document.getElementById('commit-log'), `COMMIT_SUCCESS: ${a.title}`, 'var(--legal)');
        });

        function engageSequence() {
            const s = document.getElementById('id-min').value;
            const e = document.getElementById('id-max').value;
            const y1 = document.getElementById('y-min').value;
            const y2 = document.getElementById('y-max').value;
            const sl = document.getElementById('safe-tog').checked ? document.getElementById('safe-floor').value : null;
            let url = `/api/start?mode=${selectedMode}&start=${s}&end=${e}&resume=${resumeOn}`;
            if(y1) url += `&minYear=${y1}`; if(y2) url += `&maxYear=${y2}`; if(sl) url += `&storageLimit=${sl}`;
            fetch(url); isP = false; updatePauseUI(); toast(`ENGAGING_${selectedMode}_PROTOCOL`, 'var(--primary)');
        }

        function pauseSession() { isP = !isP; fetch(isP ? '/api/pause' : '/api/resume'); updatePauseUI(); toast(isP ? "HARVEST_PAUSED" : "HARVEST_RESUMED", isP ? "var(--ghost)" : "var(--legal)"); }
        function toggleResumeState() { resumeOn = !resumeOn; const b = document.getElementById('res-btn'); b.innerText = resumeOn ? 'Resume ON' : 'Resume OFF'; b.classList.toggle('active', resumeOn); toast(resumeOn ? "STATE_LINK_LOCKED" : "STATE_LINK_SEVERED", "#fff"); }
        function updatePauseUI() { const b = document.getElementById('p-btn'); b.innerText = isP ? 'Resume Process' : 'Pause Stream'; b.classList.toggle('active', isP); }
        async function terminateMatrix() { if(confirm("DANGER: WIPE LOCAL DATA REPOSITORY?")) { await fetch('/api/flush'); location.reload(); } }

        function toggleMatrix(on) {
            const bg = document.getElementById('matrix-bg'); if(!on) { bg.style.opacity = 0; return; }
            bg.innerHTML = ''; bg.style.opacity = 0.25; 
            const canvas = document.createElement('canvas'); bg.appendChild(canvas);
            const ctx = canvas.getContext('2d'); canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            const l = "01010101アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヲン";
            const f = 16; const drops = Array(Math.floor(canvas.width/f)).fill(1);
            setInterval(() => {
                ctx.fillStyle = "rgba(0,0,0,0.05)"; ctx.fillRect(0,0,canvas.width,canvas.height);
                ctx.fillStyle = getComputedStyle(body).getPropertyValue('--primary'); ctx.font = f + "px 'JetBrains Mono'";
                drops.forEach((y, i) => {
                    ctx.fillText(l[Math.floor(Math.random()*l.length)], i*f, y*f);
                    if(y*f > canvas.height && Math.random() > 0.975) drops[i] = 0; drops[i]++;
                });
            }, 33);
        }
    </script>
</body>
</html>
